const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.es-DjavM7GZ.js","assets/index-zmUL2sLU.js","assets/index-CM6IHT5_.css"])))=>i.map(i=>d[i]);
import{B as L,h as J,j as z,n as R,a as C,k as j,_ as B,D as O,l as I,c as $,b as M,d as K,m as N,o as Y,g as x,N as k,q as G,s as X,u as Z,p as ee,e as ne,v as ae,f as te}from"./index-zmUL2sLU.js";const se=n=>n;class ie extends L{constructor({body:a,error:t,url:c}){super("RPC Request failed.",{cause:t,details:t.message,metaMessages:[`URL: ${se(c)}`,`Request body: ${J(a)}`],name:"RpcRequestError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.code=t.code}}const ce=-1;class re extends L{constructor(a,{code:t,docsPath:c,metaMessages:s,name:e,shortMessage:i}){super(i,{cause:a,docsPath:c,metaMessages:s||(a==null?void 0:a.metaMessages),name:e||"RpcError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e||a.name,this.code=a instanceof ie?a.code:t??ce}}class H extends re{constructor(a,t){super(a,t),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.data=t.data}}class P extends H{constructor(a){super(a,{code:P.code,name:"UserRejectedRequestError",shortMessage:"User rejected the request."})}}Object.defineProperty(P,"code",{enumerable:!0,configurable:!0,writable:!0,value:4001});class _ extends H{constructor(a){super(a,{code:_.code,name:"SwitchChainError",shortMessage:"An error occurred when attempting to switch chain."})}}Object.defineProperty(_,"code",{enumerable:!0,configurable:!0,writable:!0,value:4902});const A="wallet_addEthereumChain",oe=!0,q={requestedChains:"tw.wc.requestedChains",lastUsedChainId:"tw.wc.lastUsedChainId"};async function me(n,a,t,c,s){var T,y;const e=await F(n,t,s),i=n.walletConnect;let{onDisplayUri:d}=i||{};if(!d&&s&&t!=="walletConnect"){const f=await j(t);d=p=>{const b=f.mobile.native||f.mobile.universal;if(!b)throw new Error("No app url found for wallet connect to redirect to.");const v=G(b,p).redirect;s(v)}}d&&e.events.addListener("display_uri",d);let l=i==null?void 0:i.optionalChains,r=n.chain;t==="global.safe"&&(l=Q.map(C),r&&!l.includes(r)&&(r=void 0));const{rpcMap:o,chainsToRequest:u}=W({client:n.client,chain:r,optionalChains:l});e.session&&await e.connect({...i!=null&&i.pairingTopic?{pairingTopic:i==null?void 0:i.pairingTopic}:{},optionalChains:u,chains:r?[r.id]:u.length>0?[u[0]]:[1],rpcMap:o}),U(u,c);const h=(await e.enable())[0];if(!h)throw new Error("No accounts found on provider.");const g=R(e.chainId),E=n.chain&&n.chain.id===g?n.chain:C(g);if(n){const f={optionalChains:(T=n.walletConnect)==null?void 0:T.optionalChains,chain:n.chain,pairingTopic:(y=n.walletConnect)==null?void 0:y.pairingTopic};c&&Y(c,t,f)}return i!=null&&i.onDisplayUri&&e.events.removeListener("display_uri",i.onDisplayUri),V(h,E,e,a,c)}async function pe(n,a,t,c,s){const e=c?await z(c,t):null,i=await F(e?{chain:e.chain,client:n.client,walletConnect:{pairingTopic:e.pairingTopic,optionalChains:e.optionalChains}}:{client:n.client,walletConnect:{}},t,s,!0),d=i.accounts[0];if(!d)throw new Error("No accounts found on provider.");const l=R(i.chainId),r=n.chain&&n.chain.id===l?n.chain:C(l);return V(d,r,i,a,c)}async function F(n,a,t,c=!1){var g,E,T,y;const s=await j(a),e=n.walletConnect,{EthereumProvider:i,OPTIONAL_EVENTS:d,OPTIONAL_METHODS:l}=await B(async()=>{const{EthereumProvider:f,OPTIONAL_EVENTS:w,OPTIONAL_METHODS:p}=await import("./index.es-DjavM7GZ.js");return{EthereumProvider:f,OPTIONAL_EVENTS:w,OPTIONAL_METHODS:p}},__vite__mapDeps([0,1,2]));let r=e==null?void 0:e.optionalChains,o=n.chain;a==="global.safe"&&(r=Q.map(C),o&&!r.includes(o)&&(o=void 0));const{rpcMap:u,chainsToRequest:m}=W({client:n.client,chain:o,optionalChains:r}),h=await i.init({showQrModal:(e==null?void 0:e.showQrModal)===void 0?t?!1:oe:e.showQrModal,projectId:(e==null?void 0:e.projectId)||O,optionalMethods:l,optionalEvents:d,optionalChains:m,chains:o?[o.id]:m.length>0?[m[0]]:[1],metadata:{name:((g=e==null?void 0:e.appMetadata)==null?void 0:g.name)||I().name,description:((E=e==null?void 0:e.appMetadata)==null?void 0:E.description)||I().description,url:((T=e==null?void 0:e.appMetadata)==null?void 0:T.url)||I().url,icons:[((y=e==null?void 0:e.appMetadata)==null?void 0:y.logoUrl)||I().logoUrl]},rpcMap:u,qrModalOptions:e==null?void 0:e.qrModalOptions,disableProviderPing:!0});if(h.events.setMaxListeners(Number.POSITIVE_INFINITY),c||h.session&&await h.disconnect(),a!=="walletConnect"){let f=function(){var p,b,v,D;const w=((D=(v=(b=(p=h.session)==null?void 0:p.peer)==null?void 0:b.metadata)==null?void 0:v.redirect)==null?void 0:D.native)||s.mobile.native||s.mobile.universal;t&&w&&t(w)};h.signer.client.on("session_request_sent",f),h.events.addListener("disconnect",()=>{h.signer.client.off("session_request_sent",f)})}return h}function S(n,a){return{address:x(a),async sendTransaction(s){return{transactionHash:await n.request({method:"eth_sendTransaction",params:[{gas:s.gas?M(s.gas):void 0,value:s.value?M(s.value):void 0,from:this.address,to:s.to,data:s.data}]})}},async signMessage({message:s}){const e=typeof s=="string"?X(s):s.raw instanceof Uint8Array?Z(s.raw):s.raw;return n.request({method:"personal_sign",params:[e,this.address]})},async signTypedData(s){const e=ee(s),{domain:i,message:d,primaryType:l}=e,r={EIP712Domain:ne({domain:i}),...e.types};ae({domain:i,message:d,primaryType:l,types:r});const o=te({domain:i??{},message:d,primaryType:l,types:r});return await n.request({method:"eth_signTypedData_v4",params:[this.address,o]})}}}function V(n,a,t,c,s){const e=S(t,n);async function i(){t.removeListener("accountsChanged",l),t.removeListener("chainChanged",r),t.removeListener("disconnect",d),await t.disconnect()}function d(){U([],s),s==null||s.removeItem(q.lastUsedChainId),i(),c.emit("disconnect",void 0)}function l(o){if(o[0]){const u=S(t,x(o[0]));c.emit("accountChanged",u),c.emit("accountsChanged",o)}else d()}function r(o){const u=C(R(o));c.emit("chainChanged",u),s==null||s.setItem(q.lastUsedChainId,String(o))}return t.on("accountsChanged",l),t.on("chainChanged",r),t.on("disconnect",d),t.on("session_delete",d),[e,a,i,o=>ue(t,o,s)]}function de(n){var a,t;return((t=(a=n.session)==null?void 0:a.namespaces[k])==null?void 0:t.methods)||[]}function le(n){var t,c,s;return((s=(c=(t=n.session)==null?void 0:t.namespaces[k])==null?void 0:c.chains)==null?void 0:s.map(e=>Number.parseInt(e.split(":")[1]||"")))??[]}async function ue(n,a,t){var s,e;const c=a.id;try{const i=le(n),d=de(n);if(!i.includes(c)&&d.includes(A)){const r=await $(a),o=[...new Set([...((s=a.blockExplorers)==null?void 0:s.map(m=>m.url))||[],...((e=r.explorers)==null?void 0:e.map(m=>m.url))||[]])];await n.request({method:A,params:[{chainId:M(r.chainId),chainName:r.name,nativeCurrency:r.nativeCurrency,rpcUrls:K(r),blockExplorerUrls:o.length>0?o:void 0}]});const u=await he(t);u.push(c),U(u,t)}await n.request({method:"wallet_switchEthereumChain",params:[{chainId:M(c)}]})}catch(i){const d=typeof i=="string"?i:i==null?void 0:i.message;throw/user rejected request/i.test(d)?new P(i):new _(i)}}function U(n,a){a==null||a.setItem(q.requestedChains,JSON.stringify(n))}async function he(n){const a=await n.getItem(q.requestedChains);return a?JSON.parse(a):[]}function W(n){const a={};n.chain&&(a[n.chain.id]=N({chain:n.chain,client:n.client}));const t=((n==null?void 0:n.optionalChains)||[]).slice(0,10);for(const e of t)a[e.id]=N({chain:e,client:n.client});const c=t.map(e=>e.id)||[],s=n.chain?[n.chain.id,...c]:c.length>0?c:[1];return!n.chain&&t.length===0&&(a[1]=C(1).rpc),{rpcMap:a,chainsToRequest:s}}const Q=[1,11155111,42161,43114,8453,1313161554,84532,56,42220,100,10,137,1101,324,534352];export{pe as autoConnectWC,me as connectWC};
