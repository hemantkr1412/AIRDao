const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DFO4Rudv.js","assets/index-CU0ug6Hz.css","assets/hashMessage-BRa1lSVS.js","assets/checkContractWalletSignature-BcYPfSWb.js","assets/isValidSignature-Ct3gperq.js","assets/checkContractWalletSignedTypedData-BUkpNk7y.js","assets/send-eip712-transaction-CQoCvG03.js","assets/eth_sendRawTransaction-DPdnXbFR.js","assets/concat-hex-aYp195_m.js","assets/sha256-BJoBkUQu.js"])))=>i.map(i=>d[i]);
import{B as bt,t as nt,r as Ot,w as Pt,x as _,A as Tt,y as K,z as at,C as w,E as st,F as $,I as Y,G as xt,H as rt,J as it,K as ot,L as Dt,P as Lt,M as F,O as _t,e as Et,v as Vt,Q as D,R as O,S as E,T as Ct,U as Ut,V as It,W as b,X as V,Y as H,Z as ct,$ as St,a0 as G,a1 as Ft,a2 as Nt,s as dt,a3 as B,a4 as T,a5 as Rt,a6 as k,a7 as Mt,a8 as J,a9 as $t,aa as ut,ab as x,ac as Ht,ad as Bt,ae as kt,g as jt,_ as v,p as pt,af as zt,ag as Wt,a as qt}from"./index-DFO4Rudv.js";import{populateEip712Transaction as Zt,signEip712Transaction as Kt}from"./send-eip712-transaction-CQoCvG03.js";import{concatHex as Yt}from"./concat-hex-aYp195_m.js";import{m as Jt}from"./sha256-BJoBkUQu.js";class Qt extends bt{constructor(e){super(`Filter type "${e}" is not supported.`,{name:"FilterTypeNotSupportedError"})}}const I=nt;function Xt(t){const{abi:e,args:n=[],name:a}=t,r=Ot(a,{strict:!1}),s=e.filter(i=>r?i.type==="function"?Pt(i)===a:i.type==="event"?I(i)===a:!1:"name"in i&&i.name===a);if(s.length===0)return;if(s.length===1)return s[0];let o;for(const i of s){if(!("inputs"in i))continue;if(!n||n.length===0){if(!i.inputs||i.inputs.length===0)return i;continue}if(!i.inputs||i.inputs.length===0||i.inputs.length!==n.length)continue;if(n.every((d,u)=>{const f="inputs"in i&&i.inputs[u];return f?N(d,f):!1})){if(o&&"inputs"in o&&o.inputs){const d=lt(i.inputs,o.inputs,n);if(d)throw new Tt({abiItem:i,type:d[0]},{abiItem:o,type:d[1]})}o=i}}return o||s[0]}function N(t,e){const n=typeof t,a=e.type;switch(a){case"address":return _(t,{strict:!1});case"bool":return n==="boolean";case"function":return n==="string";case"string":return n==="string";default:return a==="tuple"&&"components"in e?Object.values(e.components).every((r,s)=>N(Object.values(t)[s],r)):/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(a)?n==="number"||n==="bigint":/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(a)?n==="string"||t instanceof Uint8Array:/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(a)?Array.isArray(t)&&t.every(r=>N(r,{...e,type:a.replace(/(\[[0-9]{0,}\])$/,"")})):!1}}function lt(t,e,n){for(const a in t){const r=t[a],s=e[a];if(r.type==="tuple"&&s.type==="tuple"&&"components"in r&&"components"in s)return lt(r.components,s.components,n[a]);const o=[r.type,s.type];if(o.includes("address")&&o.includes("bytes20")?!0:o.includes("address")&&o.includes("string")?_(n[a],{strict:!1}):o.includes("address")&&o.includes("bytes")?_(n[a],{strict:!1}):!1)return o}}const Q="/docs/contract/encodeEventTopics";function te(t){var c;const{abi:e,eventName:n,args:a}=t;let r=e[0];if(n){const d=Xt({abi:e,name:n});if(!d)throw new K(n,{docsPath:Q});r=d}if(r.type!=="event")throw new K(void 0,{docsPath:Q});const s=at(r),o=I(s);let i=[];if(a&&"inputs"in r){const d=(c=r.inputs)==null?void 0:c.filter(f=>"indexed"in f&&f.indexed),u=Array.isArray(a)?a:Object.values(a).length>0?(d==null?void 0:d.map(f=>a[f.name]))??[]:[];u.length>0&&(i=(d==null?void 0:d.map((f,m)=>Array.isArray(u[m])?u[m].map((y,g)=>X({param:f,value:u[m][g]})):u[m]?X({param:f,value:u[m]}):null))??[])}return[o,...i]}function X({param:t,value:e}){if(t.type==="string"||t.type==="bytes")return w(st(e));if(t.type==="tuple"||t.type.match(/^(.*)\[(\d+)?\]$/))throw new Qt(t.type);return $([t],[e])}function ee(t,e){if(!_(t,{strict:!1}))throw new Y({address:t});if(!_(e,{strict:!1}))throw new Y({address:e});return t.toLowerCase()===e.toLowerCase()}const tt="/docs/contract/decodeEventLog";function ne(t){const{abi:e,data:n,strict:a,topics:r}=t,s=a??!0,[o,...i]=r;if(!o)throw new xt({docsPath:tt});const c=e.length===1?e[0]:e.find(p=>p.type==="event"&&o===I(at(p)));if(!(c&&"name"in c)||c.type!=="event")throw new rt(o,{docsPath:tt});const{name:d,inputs:u}=c,f=u==null?void 0:u.some(p=>!("name"in p&&p.name));let m=f?[]:{};const y=u.filter(p=>"indexed"in p&&p.indexed);for(let p=0;p<y.length;p++){const l=y[p],h=i[p];if(!h)throw new it({abiItem:c,param:l});m[f?p:l.name||p]=ae({param:l,value:h})}const g=u.filter(p=>!("indexed"in p&&p.indexed));if(g.length>0){if(n&&n!=="0x")try{const p=ot(g,n);if(p)if(f)m=[...m,...p];else for(let l=0;l<g.length;l++)m[g[l].name]=p[l]}catch(p){if(s)throw p instanceof Dt||p instanceof Lt?new F({abiItem:c,data:n,params:g,size:_t(n)}):p}else if(s)throw new F({abiItem:c,data:"0x",params:g,size:0})}return{eventName:d,args:Object.values(m).length>0?m:void 0}}function ae({param:t,value:e}){return t.type==="string"||t.type==="bytes"||t.type==="tuple"||t.type.match(/^(.*)\[(\d+)?\]$/)?e:(ot([t],e)||[])[0]}function se(t){const{abi:e,args:n,logs:a,strict:r=!0}=t,s=(()=>{if(t.eventName)return Array.isArray(t.eventName)?t.eventName:[t.eventName]})();return a.map(o=>{var i;try{const c=e.find(u=>u.type==="event"&&o.topics[0]===I(u));if(!c)return null;const d=ne({...o,abi:[c],strict:r});return s&&!s.includes(d.eventName)||!re({args:d.args,inputs:c.inputs,matchArgs:n})?null:{...d,...o}}catch(c){let d,u;if(c instanceof rt)return null;if(c instanceof F||c instanceof it){if(r)return null;d=c.abiItem.name,u=(i=c.abiItem.inputs)==null?void 0:i.some(f=>!("name"in f&&f.name))}return{...o,args:u?[]:{},eventName:d}}}).filter(Boolean)}function re(t){const{args:e,inputs:n,matchArgs:a}=t;if(!a)return!0;if(!e)return!1;function r(s,o,i){try{return s.type==="address"?ee(o,i):s.type==="string"||s.type==="bytes"?w(st(o))===i:o===i}catch{return!1}}return Array.isArray(e)&&Array.isArray(a)?a.every((s,o)=>{if(!s)return!0;const i=n[o];return i?(Array.isArray(s)?s:[s]).some(d=>r(i,d,e[o])):!1}):typeof e=="object"&&!Array.isArray(e)&&typeof a=="object"&&!Array.isArray(a)?Object.entries(a).every(([s,o])=>{if(!o)return!0;const i=n.find(d=>d.name===s);return i?(Array.isArray(o)?o:[o]).some(d=>r(i,d,e[s])):!1}):!1}function ie(t){const{domain:e={},message:n,primaryType:a}=t,r={EIP712Domain:Et({domain:e}),...t.types};Vt({domain:e,message:n,primaryType:a,types:r});const s=["0x1901"];return e&&s.push(oe({domain:e,types:r})),a!=="EIP712Domain"&&s.push(mt({data:n,primaryType:a,types:r})),w(D(s))}function oe({domain:t,types:e}){return mt({data:t,primaryType:"EIP712Domain",types:e})}function mt({data:t,primaryType:e,types:n}){const a=yt({data:t,primaryType:e,types:n});return w(a)}function yt({data:t,primaryType:e,types:n}){const a=[{type:"bytes32"}],r=[ce({primaryType:e,types:n})];for(const s of n[e]){const[o,i]=ht({types:n,name:s.name,type:s.type,value:t[s.name]});a.push(o),r.push(i)}return $(a,r)}function ce({primaryType:t,types:e}){const n=O(de({primaryType:t,types:e}));return w(n)}function de({primaryType:t,types:e}){let n="";const a=ft({primaryType:t,types:e});a.delete(t);const r=[t,...Array.from(a).sort()];for(const s of r)n+=`${s}(${e[s].map(({name:o,type:i})=>`${i} ${o}`).join(",")})`;return n}function ft({primaryType:t,types:e},n=new Set){const a=t.match(/^\w*/u),r=a==null?void 0:a[0];if(n.has(r)||e[r]===void 0)return n;n.add(r);for(const s of e[r])ft({primaryType:s.type,types:e},n);return n}function ht({types:t,name:e,type:n,value:a}){if(t[n]!==void 0)return[{type:"bytes32"},w(yt({data:a,primaryType:n,types:t}))];if(n==="bytes")return a=`0x${(a.length%2?"0":"")+a.slice(2)}`,[{type:"bytes32"},w(a)];if(n==="string")return[{type:"bytes32"},w(O(a))];if(n.lastIndexOf("]")===n.length-1){const r=n.slice(0,n.lastIndexOf("[")),s=a.map(o=>ht({name:e,type:r,types:t,value:o}));return[{type:"bytes32"},w($(s.map(([o])=>o),s.map(([,o])=>o)))]}return[{type:n},a]}const ue="0xdd62ed3e",pe=[{type:"address",name:"owner"},{type:"address",name:"spender"}],le=[{type:"uint256"}];async function me(t){return E({contract:t.contract,method:[ue,pe,le],params:[t.owner,t.spender]})}function ye(t){return t.id===324||t.id===300||t.id===302||t.id===11124}function fe(t){const{logs:e,events:n,strict:a}=t;return se({logs:e,abi:n.map(r=>r.abiEvent),strict:a})}function he(t){return!!(t&&typeof t=="object"&&"type"in t&&t.type==="event")}function gt(t){const{signature:e}=t;let n;return he(e)?n=e:n=Ct(e),{abiEvent:n,hash:nt(n),topics:te({abi:[n],args:t.filters})}}function ge(t={}){return gt({signature:"event UserOperationRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)",filters:t})}function Ae(t={}){return gt({signature:"event PostOpRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)",filters:t})}function Ge(t){const{receipt:e}=t,n={...e,transactionHash:e.transactionHash,blockNumber:e.blockNumber?BigInt(e.blockNumber):null,contractAddress:e.contractAddress?e.contractAddress:null,cumulativeGasUsed:e.cumulativeGasUsed?BigInt(e.cumulativeGasUsed):null,effectiveGasPrice:e.effectiveGasPrice?BigInt(e.effectiveGasPrice):null,gasUsed:e.gasUsed?BigInt(e.gasUsed):null,logs:e.logs,to:e.to?e.to:null,transactionIndex:e.transactionIndex,status:e.status,type:e.type};return e.blobGasPrice&&(n.blobGasPrice=BigInt(e.blobGasPrice)),e.blobGasUsed&&(n.blobGasUsed=BigInt(e.blobGasUsed)),{...t,receipt:n,userOpHash:t.userOpHash,actualGasCost:BigInt(t.actualGasCost),actualGasUsed:BigInt(t.actualGasUsed),nonce:BigInt(t.nonce)}}const ve=()=>{const t=BigInt(Math.floor(Math.random()*4294967296)),e=BigInt(Math.floor(Math.random()*4294967296)),n=BigInt(Math.floor(Math.random()*4294967296)),a=BigInt(Math.floor(Math.random()*4294967296)),r=BigInt(Math.floor(Math.random()*4294967296)),s=BigInt(Math.floor(Math.random()*4294967296));return t<<BigInt(160)|e<<BigInt(128)|n<<BigInt(96)|a<<BigInt(64)|r<<BigInt(32)|s};function j(t){return Object.fromEntries(Object.entries(t).map(([e,n])=>[e,n==null||Ut(n)?n:It(n)]))}async function we(t){return L({...t,operation:"eth_sendUserOperation",params:[j(t.userOp),t.options.entrypointAddress??b]})}async function C(t){const e=await L({...t,operation:"eth_estimateUserOperationGas",params:[j(t.userOp),t.options.entrypointAddress??b]});return{preVerificationGas:G(e.preVerificationGas),verificationGas:G(e.verificationGas),verificationGasLimit:G(e.verificationGasLimit),callGasLimit:G(e.callGasLimit)+Ft,paymasterVerificationGasLimit:e.paymasterVerificationGasLimit!==void 0?G(e.paymasterVerificationGasLimit):void 0,paymasterPostOpGasLimit:e.paymasterPostOpGasLimit!==void 0?G(e.paymasterPostOpGasLimit):void 0}}async function be(t){const e=await L({...t,operation:"thirdweb_getUserOperationGasPrice",params:[]});return{maxPriorityFeePerGas:G(e.maxPriorityFeePerGas),maxFeePerGas:G(e.maxFeePerGas)}}async function Oe(t){var n,a;const e=await Pe(t);if(e){if(e.success===!1){const s=(a=(n=fe({events:[ge(),Ae()],logs:e.logs})[0])==null?void 0:n.args)==null?void 0:a.revertReason;if(!s)throw new Error(`UserOp failed at txHash: ${e.receipt.transactionHash}`);const o=Nt({data:s});throw new Error(`UserOp failed with reason: '${o.args.join(",")}' at txHash: ${e.receipt.transactionHash}`)}return e.receipt}}async function Pe(t){const e=await L({options:t,operation:"eth_getUserOperationReceipt",params:[t.userOpHash]});if(e)return Ge(e)}async function Te(t){const e=await L({options:t.options,operation:"zk_paymasterData",params:[t.transaction]});return{paymaster:e.paymaster,paymasterInput:e.paymasterInput}}async function xe(t){return{transactionHash:(await L({options:t.options,operation:"zk_broadcastTransaction",params:[{...t.transaction,signedTransaction:t.signedTransaction}]})).transactionHash}}async function L(t){const{options:e,operation:n,params:a}=t,s=V(e.entrypointAddress||b)==="v0.6"?"v1":"v2",o=e.bundlerUrl??H(e.chain,s),c=await ct(e.client)(o,{method:"POST",headers:{"Content-Type":"application/json"},body:St({jsonrpc:"2.0",id:1,method:n,params:a})}),d=await c.json();if(!c.ok||d.error){let u=d.error||c.statusText;typeof u=="object"&&(u=JSON.stringify(u));const f=d.code||"UNKNOWN";throw new Error(`${n} error: ${u}
Status: ${c.status}
Code: ${f}`)}return d.result}async function De(t){const{factoryContract:e,predictAddressOverride:n,adminAddress:a,accountSalt:r,accountAddress:s}=t;if(n)return n(e);if(s)return s;if(!a)throw new Error("Account address is required to predict the smart wallet address.");const o=dt(r??"");return E({contract:e,method:"function getAddress(address, bytes) returns (address)",params:[a,o]})}function At(t){const{adminAddress:e,factoryContract:n,createAccountOverride:a,accountSalt:r}=t;return a?a(n):B({contract:n,method:"function createAccount(address, bytes) returns (address)",params:[e,dt(r??"")]})}function Gt(t){const{accountContract:e,transaction:n,executeOverride:a}=t;return a?a(e,n):B({contract:e,method:"function execute(address, uint256, bytes)",params:[n.to||"",n.value||0n,n.data||"0x"]})}function Le(t){const{accountContract:e,transactions:n,executeBatchOverride:a}=t;return a?a(e,n):B({contract:e,method:"function executeBatch(address[], uint256[], bytes[])",params:[n.map(r=>r.to||""),n.map(r=>r.value||0n),n.map(r=>r.data||"0x")]})}const _e="0x35567e1a",Ee=[{type:"address",name:"sender"},{type:"uint192",name:"key"}],Ve=[{type:"uint256",name:"nonce"}];async function Ce(t){return E({contract:t.contract,method:[_e,Ee,Ve],params:[t.sender,t.key]})}const Ue="0xa6193531",Ie=[{type:"tuple",name:"userOp",components:[{type:"address",name:"sender"},{type:"uint256",name:"nonce"},{type:"bytes",name:"initCode"},{type:"bytes",name:"callData"},{type:"uint256",name:"callGasLimit"},{type:"uint256",name:"verificationGasLimit"},{type:"uint256",name:"preVerificationGas"},{type:"uint256",name:"maxFeePerGas"},{type:"uint256",name:"maxPriorityFeePerGas"},{type:"bytes",name:"paymasterAndData"},{type:"bytes",name:"signature"}]}],Se=[{type:"bytes32"}];async function Fe(t){return E({contract:t.contract,method:[Ue,Ie,Se],params:[t.userOp]})}const Ne="0x22cdde4c",Re=[{type:"tuple",name:"userOp",components:[{type:"address",name:"sender"},{type:"uint256",name:"nonce"},{type:"bytes",name:"initCode"},{type:"bytes",name:"callData"},{type:"bytes32",name:"accountGasLimits"},{type:"uint256",name:"preVerificationGas"},{type:"bytes32",name:"gasFees"},{type:"bytes",name:"paymasterAndData"},{type:"bytes",name:"signature"}]}],Me=[{type:"bytes32"}];async function $e(t){return E({contract:t.contract,method:[Ne,Re,Me],params:[t.userOp]})}function He(t){return t.factory?D([t.factory,t.factoryData||"0x"]):"0x"}function Be(t){return D([T(O(t.verificationGasLimit),{size:16}),T(O(t.callGasLimit),{size:16})])}function ke(t){return D([T(O(t.maxPriorityFeePerGas),{size:16}),T(O(t.maxFeePerGas),{size:16})])}function je(t){return t.paymaster?D([t.paymaster,T(O(t.paymasterVerificationGasLimit||BigInt(0)),{size:16}),T(O(t.paymasterPostOpGasLimit||BigInt(0)),{size:16}),t.paymasterData||"0x"]):"0x"}const ze=t=>({sender:t.sender,nonce:t.nonce,initCode:He(t),callData:t.callData,accountGasLimits:Be(t),preVerificationGas:t.preVerificationGas,gasFees:ke(t),paymasterAndData:je(t),signature:t.signature});async function U(t){var p;const{userOp:e,paymasterOverride:n,client:a,chain:r,entrypointAddress:s}=t;if(n)return n(e);const o={"Content-Type":"application/json"},i=s??b,d=V(i)==="v0.6"?"v1":"v2",u=H(r,d),m=await ct(a)(u,{method:"POST",headers:o,body:JSON.stringify({jsonrpc:"2.0",id:1,method:"pm_sponsorUserOperation",params:[j(e),i]})}),y=await m.json();if(!m.ok){const l=y.error||m.statusText,h=y.code||"UNKNOWN";throw new Error(`Paymaster error: ${l}
Status: ${m.status}
Code: ${h}`)}if(y.result)return typeof y.result=="string"?{paymasterAndData:y.result}:{paymasterAndData:y.result.paymasterAndData,verificationGasLimit:y.result.verificationGasLimit?G(y.result.verificationGasLimit):void 0,preVerificationGas:y.result.preVerificationGas?G(y.result.preVerificationGas):void 0,callGasLimit:y.result.callGasLimit?G(y.result.callGasLimit):void 0,paymaster:y.result.paymaster,paymasterData:y.result.paymasterData,paymasterVerificationGasLimit:y.result.paymasterVerificationGasLimit?G(y.result.paymasterVerificationGasLimit):void 0,paymasterPostOpGasLimit:y.result.paymasterPostOpGasLimit?G(y.result.paymasterPostOpGasLimit):void 0};const g=((p=y.error)==null?void 0:p.message)||y.error||m.statusText||"unknown error";throw new Error(`Paymaster error from ${u}: ${g}`)}const z=new Set,W=t=>`${t.chain.id}:${t.address}`,vt=t=>{z.add(W(t))},We=t=>{z.delete(W(t))},q=t=>z.has(W(t));async function qe(t){const e=t.timeoutMs||12e4,n=t.intervalMs||1e3,a=Date.now()+e;for(;Date.now()<a;){const r=await Oe(t);if(r)return r;await new Promise(s=>setTimeout(s,n))}throw new Error("Timeout waiting for userOp to be mined")}async function Ze(t){var h;const{transaction:e,accountContract:n,factoryContract:a,adminAddress:r,overrides:s,sponsorGas:o}=t,i=e.chain,c=e.client,d={client:c,chain:i,entrypointAddress:s==null?void 0:s.entrypointAddress},u=V(((h=t.overrides)==null?void 0:h.entrypointAddress)||b),[f,m,y,g]=await Promise.all([Rt(n),k(e),Ke({executeTx:e,bundlerOptions:d,chain:i,client:c}),tn({accountContract:n,chain:i,client:c,entrypointAddress:s==null?void 0:s.entrypointAddress,getNonceOverride:s==null?void 0:s.getAccountNonce})]),{maxFeePerGas:p,maxPriorityFeePerGas:l}=y;return u==="v0.7"?Ye({bundlerOptions:d,factoryContract:a,accountContract:n,adminAddress:r,sponsorGas:o,overrides:s,isDeployed:f,nonce:g,callData:m,maxFeePerGas:p,maxPriorityFeePerGas:l}):Je({bundlerOptions:d,factoryContract:a,accountContract:n,adminAddress:r,sponsorGas:o,overrides:s,isDeployed:f,nonce:g,callData:m,maxFeePerGas:p,maxPriorityFeePerGas:l})}async function Ke(t){const{executeTx:e,bundlerOptions:n,chain:a,client:r}=t;let{maxFeePerGas:s,maxPriorityFeePerGas:o}=e;const c=V(n.entrypointAddress||b)==="v0.6"?"v1":"v2",d=(n==null?void 0:n.bundlerUrl)??H(a,c);if(Mt(d)){const u=await be({options:n});s=u.maxFeePerGas,o=u.maxPriorityFeePerGas}else{const[u,f]=await Promise.all([J(s),J(o)]);if(u&&f)s=u,o=f;else{const m=await $t(r,a);o=f??m.maxPriorityFeePerGas??0n,s=u??m.maxFeePerGas??0n}}return{maxFeePerGas:s,maxPriorityFeePerGas:o}}async function Ye(t){const{bundlerOptions:e,isDeployed:n,factoryContract:a,accountContract:r,adminAddress:s,sponsorGas:o,overrides:i,nonce:c,callData:d,maxFeePerGas:u,maxPriorityFeePerGas:f}=t,{chain:m,client:y}=e;let g,p;n||q(r)?(p="0x",await wt(r)):(g=a.address,p=await k(At({factoryContract:a,adminAddress:s,accountSalt:i==null?void 0:i.accountSalt,createAccountOverride:i==null?void 0:i.createAccount})),vt(r));const l={sender:r.address,nonce:c,callData:d,maxFeePerGas:u,maxPriorityFeePerGas:f,callGasLimit:0n,verificationGasLimit:0n,preVerificationGas:0n,factory:g,factoryData:p,paymaster:void 0,paymasterData:"0x",paymasterVerificationGasLimit:0n,paymasterPostOpGasLimit:0n,signature:ut};if(o){const h=await U({userOp:l,chain:m,client:y,entrypointAddress:i==null?void 0:i.entrypointAddress,paymasterOverride:i==null?void 0:i.paymaster});if(h.paymaster&&h.paymasterData&&(l.paymaster=h.paymaster,l.paymasterData=h.paymasterData),h.callGasLimit&&h.verificationGasLimit&&h.preVerificationGas&&h.paymasterPostOpGasLimit&&h.paymasterVerificationGasLimit)l.callGasLimit=h.callGasLimit,l.verificationGasLimit=h.verificationGasLimit,l.preVerificationGas=h.preVerificationGas,l.paymasterPostOpGasLimit=h.paymasterPostOpGasLimit,l.paymasterVerificationGasLimit=h.paymasterVerificationGasLimit;else{const A=await C({userOp:l,options:e});l.callGasLimit=A.callGasLimit,l.verificationGasLimit=A.verificationGasLimit,l.preVerificationGas=A.preVerificationGas,l.paymasterPostOpGasLimit=h.paymasterPostOpGasLimit||0n,l.paymasterVerificationGasLimit=h.paymasterVerificationGasLimit||0n;const P=await U({userOp:l,chain:m,client:y,entrypointAddress:i==null?void 0:i.entrypointAddress,paymasterOverride:i==null?void 0:i.paymaster});P.paymaster&&P.paymasterData&&(l.paymaster=P.paymaster,l.paymasterData=P.paymasterData)}}else{const h=await C({userOp:l,options:e});l.callGasLimit=h.callGasLimit,l.verificationGasLimit=h.verificationGasLimit,l.preVerificationGas=h.preVerificationGas,l.paymasterPostOpGasLimit=h.paymasterPostOpGasLimit||0n,l.paymasterVerificationGasLimit=h.paymasterVerificationGasLimit||0n}return{...l,signature:"0x"}}async function Je(t){const{bundlerOptions:e,isDeployed:n,factoryContract:a,accountContract:r,adminAddress:s,sponsorGas:o,overrides:i,nonce:c,callData:d,maxFeePerGas:u,maxPriorityFeePerGas:f}=t,{chain:m,client:y}=e;let g;n||q(r)?(g="0x",await wt(r)):(g=await Xe({factoryContract:a,adminAddress:s,accountSalt:i==null?void 0:i.accountSalt,createAccountOverride:i==null?void 0:i.createAccount}),vt(r));const p={sender:r.address,nonce:c,initCode:g,callData:d,maxFeePerGas:u,maxPriorityFeePerGas:f,callGasLimit:0n,verificationGasLimit:0n,preVerificationGas:0n,paymasterAndData:"0x",signature:ut};if(o){const l=await U({userOp:p,chain:m,client:y,entrypointAddress:i==null?void 0:i.entrypointAddress,paymasterOverride:i==null?void 0:i.paymaster}),h="paymasterAndData"in l?l.paymasterAndData:"0x";if(h&&h!=="0x"&&(p.paymasterAndData=h),l.callGasLimit&&l.verificationGasLimit&&l.preVerificationGas)p.callGasLimit=l.callGasLimit,p.verificationGasLimit=l.verificationGasLimit,p.preVerificationGas=l.preVerificationGas;else{const A=await C({userOp:p,options:e});if(p.callGasLimit=A.callGasLimit,p.verificationGasLimit=A.verificationGasLimit,p.preVerificationGas=A.preVerificationGas,h&&h!=="0x"){const P=await U({userOp:p,chain:m,client:y,entrypointAddress:i==null?void 0:i.entrypointAddress,paymasterOverride:i==null?void 0:i.paymaster}),S="paymasterAndData"in P?P.paymasterAndData:"0x";S&&S!=="0x"&&(p.paymasterAndData=S)}}}else{const l=await C({userOp:p,options:e});p.callGasLimit=l.callGasLimit,p.verificationGasLimit=l.verificationGasLimit,p.preVerificationGas=l.preVerificationGas}return{...p,signature:"0x"}}async function Qe(t){const{userOp:e,chain:n,entrypointAddress:a,adminAccount:r}=t,s=V(a||b);let o;if(s==="v0.7"){const i=ze(e);o=await $e({contract:x({address:a||Ht,chain:n,client:t.client}),userOp:i})}else o=await Fe({contract:x({address:a||b,chain:n,client:t.client}),userOp:e});if(r.signMessage){const i=await r.signMessage({message:{raw:Bt(o)}});return{...e,signature:i}}throw new Error("signMessage not implemented in signingAccount")}async function Xe(t){const{factoryContract:e,adminAddress:n,accountSalt:a,createAccountOverride:r}=t,s=At({factoryContract:e,adminAddress:n,accountSalt:a,createAccountOverride:r});return D([e.address,await k(s)])}async function tn(t){const{accountContract:e,chain:n,client:a,entrypointAddress:r,getNonceOverride:s}=t;return s?s(e):Ce({contract:x({address:r||b,chain:n,client:a}),key:ve(),sender:e.address})}async function wt(t){const e=Date.now();for(;q(t);){if(Date.now()-e>6e4)throw new Error("Account deployment is taking too long (over 1 minute). Please try again.");await new Promise(n=>setTimeout(n,500))}}function en(t){return t.id==="smart"}const Z=new WeakMap,R=new WeakMap;async function nn(t,e,n){var g,p,l,h;const{personalAccount:a,client:r,chain:s}=e;if(!a)throw new Error("Personal wallet does not have an account");const o=n,i=o.factoryAddress??kt((g=n.overrides)==null?void 0:g.entrypointAddress),c=s??o.chain,d="gasless"in o?o.gasless:o.sponsorGas;if(ye(c))return[on({creationOptions:n,connectionOptions:e,chain:c,sponsorGas:d}),c];const u=x({client:r,address:i,chain:c}),f=await De({factoryContract:u,adminAddress:a.address,predictAddressOverride:(p=o.overrides)==null?void 0:p.predictAddress,accountSalt:(l=o.overrides)==null?void 0:l.accountSalt,accountAddress:(h=o.overrides)==null?void 0:h.accountAddress}).then(A=>A).catch(A=>{throw new Error(`Failed to get account address with factory contract ${u.address} on chain ID ${c.id}: ${(A==null?void 0:A.message)||"unknown error"}`,{cause:A})}),m=x({client:r,address:f,chain:c}),y=await sn({...o,chain:c,sponsorGas:d,personalAccount:a,accountContract:m,factoryContract:u,client:r});return Z.set(a,t),R.set(t,a),[y,c]}async function an(t){const e=R.get(t);e&&(Z.delete(e),R.delete(t))}async function sn(t){const{accountContract:e}=t,n={address:jt(e.address),async sendTransaction(a){var i,c,d;const r=(i=t.overrides)==null?void 0:i.erc20Paymaster;let s;if(r){await rn({accountContract:e,erc20Paymaster:r,options:t});const u=async()=>({paymasterAndData:Yt([r.address,r==null?void 0:r.token]),paymaster:r.address,paymasterData:"0x"});s=((c=t.overrides)==null?void 0:c.paymaster)||u}const o=Gt({accountContract:e,transaction:a,executeOverride:(d=t.overrides)==null?void 0:d.execute});return M({executeTx:o,options:{...t,overrides:{...t.overrides,paymaster:s}}})},async sendBatchTransaction(a){var s;const r=Le({accountContract:e,transactions:a,executeBatchOverride:(s=t.overrides)==null?void 0:s.executeBatch});return M({executeTx:r,options:t})},async signMessage({message:a}){const[{isContractDeployed:r},{readContract:s},{encodeAbiParameters:o},{hashMessage:i},{checkContractWalletSignature:c}]=await Promise.all([v(()=>import("./index-DFO4Rudv.js").then(g=>g.dr),__vite__mapDeps([0,1])),v(()=>import("./index-DFO4Rudv.js").then(g=>g.dt),__vite__mapDeps([0,1])),v(()=>import("./index-DFO4Rudv.js").then(g=>g.ds),__vite__mapDeps([0,1])),v(()=>import("./hashMessage-BRa1lSVS.js"),__vite__mapDeps([2,0,1])),v(()=>import("./checkContractWalletSignature-BcYPfSWb.js"),__vite__mapDeps([3,4,0,1]))]);await r(e)||await et({options:t,account:n,accountContract:e});const u=i(a);let f=!1;try{await s({contract:e,method:"function getMessageHash(bytes32 _hash) public view returns (bytes32)",params:[u]}),f=!0}catch{}let m;if(f){const g=o([{type:"bytes32"}],[u]);m=await t.personalAccount.signTypedData({domain:{name:"Account",version:"1",chainId:t.chain.id,verifyingContract:e.address},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]},message:{message:g}})}else m=await t.personalAccount.signMessage({message:a});if(await c({contract:e,message:a,signature:m}))return m;throw new Error("Unable to verify signature on smart account, please make sure the smart account is deployed and the signature is valid.")},async signTypedData(a){var p,l,h;const r=pt(a),[{isContractDeployed:s},{readContract:o},{encodeAbiParameters:i},{checkContractWalletSignedTypedData:c}]=await Promise.all([v(()=>import("./index-DFO4Rudv.js").then(A=>A.dr),__vite__mapDeps([0,1])),v(()=>import("./index-DFO4Rudv.js").then(A=>A.dt),__vite__mapDeps([0,1])),v(()=>import("./index-DFO4Rudv.js").then(A=>A.ds),__vite__mapDeps([0,1])),v(()=>import("./checkContractWalletSignedTypedData-BUkpNk7y.js"),__vite__mapDeps([5,4,0,1,6,7,8,9]))]);if(((l=(p=r.domain)==null?void 0:p.verifyingContract)==null?void 0:l.toLowerCase())===((h=e.address)==null?void 0:h.toLowerCase()))return t.personalAccount.signTypedData(r);await s(e)||await et({options:t,account:n,accountContract:e});const f=ie(r);let m=!1;try{await o({contract:e,method:"function getMessageHash(bytes32 _hash) public view returns (bytes32)",params:[f]}),m=!0}catch{}let y;if(m){const A=i([{type:"bytes32"}],[f]);y=await t.personalAccount.signTypedData({domain:{name:"Account",version:"1",chainId:t.chain.id,verifyingContract:e.address},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]},message:{message:A}})}else y=await t.personalAccount.signTypedData(r);if(await c({contract:e,data:r,signature:y}))return y;throw new Error("Unable to verify signature on smart account, please make sure the smart account is deployed and the signature is valid.")},async onTransactionRequested(a){var r,s;return(s=(r=t.personalAccount).onTransactionRequested)==null?void 0:s.call(r,a)}};return n}async function rn(t){var u;const{accountContract:e,erc20Paymaster:n,options:a}=t,r=n.token,s=x({address:r,chain:e.chain,client:e.client});if(await me({contract:s,owner:e.address,spender:n.address})>0n)return;const i=zt({contract:s,spender:n.address,amountWei:Jt-1n}),c=await Wt({transaction:i,from:e.address}),d=Gt({accountContract:e,transaction:c,executeOverride:(u=a.overrides)==null?void 0:u.execute});await M({executeTx:d,options:{...a,overrides:{...a.overrides,erc20Paymaster:void 0}}})}function on(t){const{creationOptions:e,connectionOptions:n,chain:a}=t,r={address:n.personalAccount.address,async sendTransaction(s){var u,f,m,y;const o={data:s.data,to:s.to??void 0,value:s.value??0n,chain:qt(s.chainId),client:n.client};let i=await Zt({account:r,transaction:o});if(t.sponsorGas){const g=await Te({options:{client:n.client,chain:a,bundlerUrl:(u=e.overrides)==null?void 0:u.bundlerUrl,entrypointAddress:(f=e.overrides)==null?void 0:f.entrypointAddress},transaction:i});i={...i,...g}}const c=await Kt({account:r,chainId:a.id,eip712Transaction:i});return{transactionHash:(await xe({options:{client:n.client,chain:a,bundlerUrl:(m=e.overrides)==null?void 0:m.bundlerUrl,entrypointAddress:(y=e.overrides)==null?void 0:y.entrypointAddress},transaction:i,signedTransaction:c})).transactionHash,client:n.client,chain:a}},async signMessage({message:s}){return n.personalAccount.signMessage({message:s})},async signTypedData(s){const o=pt(s);return n.personalAccount.signTypedData(o)},async onTransactionRequested(s){var o,i;return(i=(o=n.personalAccount).onTransactionRequested)==null?void 0:i.call(o,s)}};return r}async function et(t){const{options:e,account:n,accountContract:a}=t,[{sendTransaction:r},{prepareTransaction:s}]=await Promise.all([v(()=>import("./index-DFO4Rudv.js").then(c=>c.dv),__vite__mapDeps([0,1])),v(()=>import("./index-DFO4Rudv.js").then(c=>c.du),__vite__mapDeps([0,1]))]),o=s({client:e.client,chain:e.chain,to:a.address,value:0n,gas:50000n});return await r({transaction:o,account:n})}async function M(t){var c,d,u;const{executeTx:e,options:n}=t,a=await Ze({transaction:e,factoryContract:n.factoryContract,accountContract:n.accountContract,adminAddress:n.personalAccount.address,sponsorGas:n.sponsorGas,overrides:n.overrides}),r=await Qe({client:n.client,chain:n.chain,adminAccount:n.personalAccount,entrypointAddress:(c=n.overrides)==null?void 0:c.entrypointAddress,userOp:a}),s={chain:n.chain,client:n.client,bundlerUrl:(d=n.overrides)==null?void 0:d.bundlerUrl,entrypointAddress:(u=n.overrides)==null?void 0:u.entrypointAddress},o=await we({options:s,userOp:r}),i=await qe({...n,userOpHash:o});return We(n.accountContract),{client:n.client,chain:n.chain,transactionHash:i.transactionHash}}const ln=Object.freeze(Object.defineProperty({__proto__:null,connectSmartWallet:nn,disconnectSmartWallet:an,isSmartWallet:en,personalAccountToSmartAccountMap:Z},Symbol.toStringTag,{value:"Module"}));export{ie as h,ln as i};
