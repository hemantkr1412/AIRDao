import{aR as B,aV as q,aK as e,cz as Q,aM as o,aU as K,aS as F,bh as U,b4 as Y,aT as J,aJ as a,cA as P,b1 as H,b2 as i,b7 as m,bx as O,bc as w,ba as G,cB as X,cC as E,au as I,ch as T,bz as Z,aQ as R,a$ as ee}from"./index-D4W03jMB.js";import{preAuthenticate as D}from"./index-CEYX6jgy.js";import{hasStoredPasskey as ne}from"./passkeys-BCqZ42RL.js";import{l as te}from"./oauth-BiBQAhTj.js";import{o as ie}from"./useInAppWalletLocale-COiNaMIz.js";const _=B({animation:`${q} 0.15s ease-in`});function re(n){return e.jsx(se,{children:e.jsx(Q,{onComplete:()=>{n.onEnter()},maxLength:6,value:n.value,render:({slots:t})=>e.jsx(o,{flex:"row",gap:"xs",center:"both",children:t.map((g,j)=>e.jsx(oe,{...g,isInvalid:n.isInvalid},j))}),onChange:t=>{n.setValue(t)}})})}const se=B({"& input":{maxWidth:"100%"}});function oe(n){return e.jsxs(le,{"data-active":n.isActive,"data-error":n.isInvalid,children:[n.char!==null&&e.jsx("div",{children:n.char}),n.hasFakeCaret&&e.jsx(ce,{})]})}const ae=K`
  0%, 100% {
    opacity: 0;
  },
  50% {
    opacity: 1;
  }
  `,ce=B(n=>{const t=F();return{position:"absolute",pointerEvents:"none",inset:0,display:"flex",alignItems:"center",justifyContent:"center",animation:`${ae} 1s infinite`,"&::before":{content:"''",display:"block",width:"1.5px",height:"1em",backgroundColor:t.colors.primaryText}}}),le=B(n=>{const t=F();return{position:"relative",width:"40px",height:"40px",textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",fontSize:U.md,padding:Y.xs,boxSizing:"border-box",transition:"color 200ms ease",border:`2px solid ${t.colors.borderColor}`,"&[data-active='true']":{borderColor:t.colors.accentText},color:t.colors.primaryText,borderRadius:J.lg,"&[data-error='true']":{borderColor:t.colors.danger}}});function ke(n){const{wallet:t,done:g,goBack:j,userInfo:r}=n,f=n.size==="wide",d=n.locale,[c,h]=a.useState(""),[l,x]=a.useState("idle"),[y,A]=a.useState(),[C,u]=a.useState("sending"),L=a.useMemo(()=>P(t.id),[t.id]),[z]=a.useState("base"),S=a.useCallback(async()=>{var s,k;h(""),x("idle"),u("sending");try{if("email"in r)await D({ecosystem:L?{id:t.id,partnerId:(s=t.getConfig())==null?void 0:s.partnerId}:void 0,email:r.email,strategy:"email",client:n.client}),u("sent");else if("phone"in r)await D({ecosystem:L?{id:t.id,partnerId:(k=t.getConfig())==null?void 0:k.partnerId}:void 0,phoneNumber:r.phone,strategy:"phone",client:n.client}),u("sent");else throw new Error("Invalid userInfo")}catch(p){console.error(p),x("idle"),u("error")}},[n.client,r,t,L]);async function W(s){if("email"in r)await t.connect({chain:n.chain,strategy:"email",email:r.email,verificationCode:s,client:n.client}),await E("email",I);else if("phone"in r)await t.connect({chain:n.chain,strategy:"phone",phoneNumber:r.phone,verificationCode:s,client:n.client}),await E("phone",I);else throw new Error("Invalid userInfo")}async function M(s){"email"in r?await T(t,{strategy:"email",email:r.email,verificationCode:s}):"phone"in r&&await T(t,{strategy:"phone",phoneNumber:r.phone,verificationCode:s})}const v=async s=>{var k;if(s.length===6){x("verifying");try{n.isLinking?await M(s):await W(s),g(),x("valid")}catch(p){p instanceof Error&&((k=p==null?void 0:p.message)!=null&&k.includes("PAYMENT_METHOD_REQUIRED"))?x("payment_required"):p instanceof Error&&(p.message.toLowerCase().includes("link")||p.message.toLowerCase().includes("profile"))?(x("linking_error"),A(p.message)):x("invalid"),console.error("Authentication Error",p)}}},b=a.useRef(!1);return a.useEffect(()=>{b.current||(b.current=!0,S())},[S]),z==="base"?e.jsxs(o,{fullHeight:!0,flex:"column",animate:"fadein",children:[e.jsx(o,{p:"lg",children:e.jsx(H,{title:d.signIn,onBack:j})}),e.jsx(o,{expand:!0,flex:"column",center:"y",children:e.jsxs("form",{onSubmit:s=>{s.preventDefault()},children:[e.jsxs(o,{flex:"column",center:"x",px:"lg",children:[!f&&e.jsx(i,{y:"xl"}),e.jsx(m,{children:d.emailLoginScreen.enterCodeSendTo}),e.jsx(i,{y:"sm"}),e.jsx(m,{color:"primaryText",children:"email"in r?r.email:r.phone}),e.jsx(i,{y:"xl"})]}),e.jsx(re,{isInvalid:l==="invalid",digits:6,value:c,setValue:s=>{h(s),x("idle")},onEnter:()=>{v(c)}}),l==="invalid"&&e.jsxs(_,{children:[e.jsx(i,{y:"md"}),e.jsx(m,{size:"sm",color:"danger",center:!0,children:d.emailLoginScreen.invalidCode})]}),l==="linking_error"&&e.jsxs(_,{children:[e.jsx(i,{y:"md"}),e.jsx(m,{size:"sm",color:"danger",center:!0,children:y||"Failed to verify code"})]}),l==="payment_required"&&e.jsxs(_,{children:[e.jsx(i,{y:"md"}),e.jsx(m,{size:"sm",color:"danger",center:!0,children:d.maxAccountsExceeded})]}),e.jsx(i,{y:"xl"}),e.jsx(o,{px:f?"xxl":"lg",children:l==="verifying"?e.jsx(e.Fragment,{children:e.jsx(o,{flex:"row",center:"x",animate:"fadein",children:e.jsx(O,{size:"lg",color:"accentText"})})}):e.jsx(o,{animate:"fadein",children:e.jsx(w,{onClick:()=>v(c),variant:"accent",type:"submit",style:{width:"100%"},children:d.emailLoginScreen.verify})},"btn-container")}),e.jsx(i,{y:"xl"}),!f&&e.jsx(G,{}),e.jsxs(o,{p:f?void 0:"lg",children:[C==="error"&&e.jsx(e.Fragment,{children:e.jsx(m,{size:"sm",center:!0,color:"danger",children:d.emailLoginScreen.failedToSendCode})}),C==="sending"&&e.jsxs(o,{flex:"row",center:"both",gap:"xs",style:{textAlign:"center"},children:[e.jsx(m,{size:"sm",children:d.emailLoginScreen.sendingCode}),e.jsx(O,{size:"xs",color:"secondaryText"})]}),C==="sent"&&e.jsx(de,{onClick:S,type:"button",children:d.emailLoginScreen.resendCode})]})]})})]}):null}const de=X(n=>{const t=F();return{all:"unset",color:t.colors.accentText,fontSize:U.sm,cursor:"pointer",textAlign:"center",fontWeight:500,width:"100%","&:hover":{color:t.colors.primaryText}}}),$=n=>e.jsxs("svg",{width:n.size,height:n.size,viewBox:"0 0 36 36",fill:"none","aria-hidden":"true",children:[e.jsx("path",{d:"M18.0001 15C17.2045 15 16.4414 15.3161 15.8788 15.8787C15.3162 16.4413 15.0001 17.2044 15.0001 18C15.0001 19.53 14.8501 21.765 14.6101 24",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M21.0002 19.6801C21.0002 23.2501 21.0002 29.2501 19.5002 33.0001",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M25.9348 31.53C26.1148 30.63 26.5798 28.08 26.6848 27",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M2.99976 18C2.99976 14.8518 3.99032 11.7833 5.83112 9.22935C7.67193 6.67536 10.2697 4.76531 13.2563 3.76975C16.243 2.77419 19.4672 2.74359 22.4723 3.6823C25.4773 4.621 28.1108 6.48141 29.9998 9",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M2.99976 24H3.01628",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M32.7 24C33 21 32.8965 15.969 32.7 15",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M7.49976 29.25C8.24976 27 8.99976 22.5 8.99976 18C8.99824 16.9783 9.17071 15.9638 9.50976 15",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M12.9751 33C13.2901 32.01 13.6501 31.02 13.8301 30",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M13.5 10.2C14.8686 9.40988 16.4211 8.99401 18.0014 8.99426C19.5818 8.99452 21.1342 9.41088 22.5025 10.2015C23.8708 10.9921 25.0069 12.129 25.7964 13.498C26.5859 14.867 27.001 16.4197 27 18V21",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"})]});function N(n){return e.jsxs(o,{animate:"fadein",children:[e.jsx(i,{y:"xxl"}),e.jsx(o,{flex:"row",center:"x",children:e.jsx(Z,{size:R["3xl"]})}),e.jsx(i,{y:"lg"}),e.jsx(m,{center:!0,color:"primaryText",size:"md",children:n.title}),e.jsx(i,{y:"xl"}),e.jsx(i,{y:"xxl"}),e.jsx(w,{variant:"accent",fullWidth:!0,onClick:n.onTryAgain,children:"Try Again"})]})}function V(n){return e.jsxs(o,{animate:"fadein",children:[e.jsx(i,{y:"xxl"}),e.jsxs(o,{flex:"row",center:"x",style:{position:"relative"},children:[e.jsx(O,{size:"4xl",color:"accentText"}),e.jsx(o,{color:"accentText",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:n.icon})]}),e.jsx(i,{y:"xl"}),e.jsx(m,{center:!0,color:"primaryText",size:"lg",children:n.title}),e.jsx(i,{y:"md"}),e.jsx(m,{multiline:!0,center:!0,children:n.subtitle}),e.jsx(i,{y:"xxl"}),e.jsx(i,{y:"xxl"})]})}function pe(n){const{wallet:t,done:g,client:j,chain:r,size:f,locale:d}=n,[c,h]=a.useState("loading"),l=a.useRef(!1);return a.useEffect(()=>{l.current||(l.current=!0,ne(j,P(t.id)?t.id:void 0).then(x=>{h(x?"login":"select")}).catch(()=>{h("select")}))},[j,t.id]),e.jsxs(o,{animate:"fadein",fullHeight:!0,flex:"column",children:[e.jsx(o,{p:"lg",children:e.jsx(H,{title:n.isLinking?d.passkeys.linkPasskey:d.passkeys.title,onBack:n.onBack})}),e.jsx(o,{px:f==="wide"?"xxl":"lg",expand:!0,flex:"column",center:"y",children:e.jsxs("div",{children:[c==="loading"&&e.jsxs(e.Fragment,{children:[e.jsx(ee,{}),e.jsx(i,{y:"xxl"})]}),c==="select"&&e.jsx(he,{onSignin:()=>{h("login")},onSignup:()=>{h("signup")}}),c==="login"&&e.jsx(ue,{wallet:t,client:j,done:g,onCreate:()=>{h("signup")},chain:r,isLinking:n.isLinking}),c==="signup"&&e.jsx(xe,{wallet:t,client:j,done:g,chain:r,isLinking:n.isLinking})]})})]})}function ue(n){const{wallet:t,done:g,client:j,chain:r}=n,[f,d]=a.useState("loading"),[c,h]=a.useState();async function l(){d("loading");try{n.isLinking?await T(t,{strategy:"passkey",type:"sign-in"}).catch(y=>{throw h(y.message),y}):(await t.connect({client:j,strategy:"passkey",type:"sign-in",chain:r}),await E("passkey",I)),g()}catch{d("error")}}const x=a.useRef(!1);return a.useEffect(()=>{x.current||(x.current=!0,l())}),f==="loading"?e.jsx(V,{title:"Requesting Passkey",subtitle:"A pop-up prompt will appear to sign-in and verify your passkey",icon:e.jsx($,{size:R.xxl})}):f==="error"?e.jsxs(e.Fragment,{children:[e.jsx(N,{onTryAgain:l,title:c||"Failed to Login"}),e.jsx(i,{y:"sm"}),e.jsx(w,{variant:"outline",fullWidth:!0,onClick:n.onCreate,children:"Create a new Passkey"}),e.jsx(i,{y:"lg"})]}):null}function xe(n){const{wallet:t,done:g,client:j,chain:r}=n,[f,d]=a.useState(),[c,h]=a.useState("loading");async function l(){h("loading");try{n.isLinking?await T(t,{strategy:"passkey",type:"sign-up"}):(await t.connect({client:j,strategy:"passkey",type:"sign-up",chain:r}),await E("passkey",I)),g()}catch(y){console.error(y),y instanceof Error&&d(`Error creating passkey: ${y.message}`),h("error")}}const x=a.useRef(!1);return a.useEffect(()=>{x.current||(x.current=!0,l())}),c==="loading"?e.jsx(V,{title:"Creating Passkey",subtitle:"A pop-up prompt will appear to sign-in and verify your passkey",icon:e.jsx($,{size:R.xxl})}):c==="error"?e.jsxs(e.Fragment,{children:[e.jsx(N,{onTryAgain:l,title:f||"Failed to create passkey"}),e.jsx(i,{y:"lg"})]}):null}function he(n){return e.jsxs(o,{children:[e.jsx(i,{y:"xxl"}),e.jsx(o,{flex:"row",center:"x",color:"accentText",children:e.jsx($,{size:R["4xl"]})}),e.jsx(i,{y:"xl"}),e.jsx(i,{y:"xxl"}),e.jsx(w,{variant:"accent",onClick:n.onSignup,fullWidth:!0,children:"Create a Passkey"}),e.jsx(i,{y:"sm"}),e.jsx(w,{variant:"outline",onClick:n.onSignin,fullWidth:!0,children:"I have a Passkey"}),e.jsx(i,{y:"lg"})]})}function Ce(n){var C;const t=n.locale,g=t.socialLoginScreen,j=F(),[r,f]=a.useState(void 0),{done:d,wallet:c}=n,[h,l]=a.useState("connecting"),x=async()=>{var z,S,W,M,v,b;const u=c.getConfig(),L=u&&"auth"in u?((z=u==null?void 0:u.auth)==null?void 0:z.mode)??"popup":"popup";if(u&&"auth"in u&&L!=="popup"&&!n.isLinking)return te({authOption:n.socialAuth,client:n.client,ecosystem:P(c)?{id:c.id,partnerId:(S=c.getConfig())==null?void 0:S.partnerId}:void 0,redirectUrl:(W=u==null?void 0:u.auth)==null?void 0:W.redirectUrl,mode:(M=u==null?void 0:u.auth)==null?void 0:M.mode});try{const s=ie({authOption:n.socialAuth,themeObj:j,client:n.client,ecosystem:P(c)?{id:c.id,partnerId:(v=c.getConfig())==null?void 0:v.partnerId}:void 0});if(!s)throw new Error(`Failed to open ${n.socialAuth} login window`);l("connecting"),n.isLinking?await T(c,{strategy:n.socialAuth,openedWindow:s,closeOpenedWindow:k=>{k.close()}}).catch(k=>{throw f(k.message),k}):await c.connect({chain:n.chain,strategy:n.socialAuth,openedWindow:s,closeOpenedWindow:k=>{k.close()},client:n.client}),await E(n.socialAuth,I),l("connected"),d()}catch(s){l("error"),s instanceof Error&&((b=s==null?void 0:s.message)!=null&&b.includes("PAYMENT_METHOD_REQUIRED"))&&f(t.maxAccountsExceeded),console.error(`Error sign in with ${n.socialAuth}`,s)}},y=(C=n.state)==null?void 0:C.socialLogin,A=a.useRef(!1);return a.useEffect(()=>{A.current||y&&(A.current=!0,l("connecting"),y.connectionPromise.then(()=>{d(),l("connected")}).catch(u=>{f(u.message),l("error")}))},[d,y]),e.jsx(o,{animate:"fadein",flex:"column",fullHeight:!0,children:e.jsxs(o,{flex:"column",expand:!0,p:"lg",style:{paddingBottom:0},children:[n.goBack&&e.jsx(H,{title:n.isLinking?n.connectLocale.manageWallet.linkProfile:g.title,onBack:n.goBack}),n.size==="compact"?e.jsx(i,{y:"xl"}):null,e.jsxs(o,{flex:"column",center:"both",expand:!0,style:{textAlign:"center",minHeight:"250px"},children:[h!=="error"&&e.jsxs(o,{animate:"fadein",children:[e.jsx(m,{color:"primaryText",center:!0,multiline:!0,style:{maxWidth:"250px"},children:g.instruction}),e.jsx(i,{y:"xl"}),e.jsx(o,{center:"x",flex:"row",children:e.jsx(O,{size:"lg",color:"accentText"})}),e.jsx(i,{y:"xxl"})]}),h==="error"&&e.jsxs(o,{animate:"fadein",children:[r?e.jsx(m,{center:!0,color:"danger",children:r}):e.jsx(m,{color:"danger",children:g.failed}),e.jsx(i,{y:"lg"}),e.jsx(w,{variant:"primary",onClick:x,children:g.retry}),e.jsx(i,{y:"xxl"})]})]})]})})}export{N as E,V as L,ke as O,pe as P,Ce as S};
